<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Docs-as-System™ – Document</title>
  <link rel="icon" href="./logo.svg">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root{--bg:#fff;--ink:#0b1220;--muted:#5b6472;--line:#e7e9ee;--maxw:980px}
    @media (prefers-color-scheme:dark){:root{--bg:#0b1220;--ink:#e9eef7;--muted:#a9b3c3;--line:#1b2433}}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);
      font-family:Assistant,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .container{max-width:var(--maxw);margin:0 auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--line)}
    .title{font-weight:800;font-size:18px}
    .crumbs a{color:inherit}
    main{padding:14px 0}
    .md{line-height:1.75}
    .md h1,.md h2,.md h3{line-height:1.25}
    .md code{background:#f3f4f6;padding:2px 6px;border-radius:6px}
    @media (prefers-color-scheme:dark){.md code{background:#111827}}
    pre{overflow:auto;padding:12px;border:1px solid var(--line);border-radius:8px}
    footer{margin:32px 0;color:var(--muted);border-top:1px solid var(--line);padding-top:12px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">Docs-as-System™</div>
      <nav class="crumbs"><a href="./index.html">Home</a> · <a href="./index.he.html" rel="alternate" lang="he" dir="rtl">עברית</a></nav>
    </header>
    <main>
      <h1 id="doc-title">Loading…</h1>
      <article id="md" class="md">Please wait.</article>
    </main>
    <footer>© <span id="yr"></span> Docs-as-System™</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    // ?src=MANIFESTO.en.md&title=Manifesto
    const q = new URLSearchParams(location.search);
    const src = q.get('src') || 'README.md';
    const title = q.get('title') || src;
    document.title = 'Docs-as-System™ – ' + title;
    document.getElementById('doc-title').textContent = title;

    async function load(src){
      try{
        const res = await fetch('./'+src, {cache:'no-store'});
        if(!res.ok) throw new Error(res.status+' '+res.statusText);
        const txt = await res.text();
        let html;
        if (src.toLowerCase().endsWith('.md')) {
          html = marked.parse(txt, {mangle:false, headerIds:true});
        } else {
          html = '<pre><code>'+ txt.replace(/[&<>]/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;' }[s])) +'</code></pre>';
        }
        document.getElementById('md').innerHTML = DOMPurify.sanitize(html);
      }catch(e){
        document.getElementById('md').textContent = 'Failed to load '+src+' ('+e.message+')';
      }
    }
    load(src);
  </script>
</body>
</html>
